(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{5463:function(e,t,s){Promise.resolve().then(s.bind(s,6753))},6753:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var i=s(7437),n=s(2265),o=s(6463),a=s(7138),r=s(6264);let l={description:"",unit:"h",quantity:1,price:0};function c(){let e=(0,o.useRouter)(),t=(0,o.useSearchParams)().get("id"),[s,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(""),[h,m]=(0,n.useState)(!1),[p,x]=(0,n.useState)([]),[b,f]=(0,n.useState)(!0),[g,v]=(0,n.useState)(!1),[j,N]=(0,n.useState)({client_id:"",invoice_date:"",due_date:"",notes:"",items:[{...l}]});(0,n.useEffect)(()=>{y();let e=localStorage.getItem("savedDescriptions");e&&x(JSON.parse(e))},[t]);let y=async()=>{try{let[s,i]=await Promise.all([r.yj.list(),t?r.Ef.get(Number(t)):null]);if(c(s),i){var e;N({client_id:String(i.client_id),invoice_date:i.invoice_date.split("T")[0],due_date:i.due_date.split("T")[0],notes:i.notes||"",items:(null===(e=i.items)||void 0===e?void 0:e.map(e=>({description:e.description,unit:e.unit,quantity:e.quantity,price:e.price})))||[{...l}]})}}catch(e){}f(!1)},w=async s=>{s.preventDefault(),v(!0);try{let s=j.items.map(e=>e.description).filter(e=>e&&!p.includes(e));if(s.length>0){let e=[...new Set([...p,...s])];localStorage.setItem("savedDescriptions",JSON.stringify(e))}await r.Ef.update(Number(t),{...j,client_id:Number(j.client_id)}),e.push("/invoices")}catch(e){}v(!1)},S=e=>{N({...j,items:j.items.filter((t,s)=>s!==e)})},k=(e,t,s)=>{let i=[...j.items];i[e]={...i[e],[t]:s},N({...j,items:i})},C=s.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())).slice(0,10),_=s.find(e=>e.id===Number(j.client_id));return b?(0,i.jsx)("div",{className:"text-white p-8",children:"Loading..."}):(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsx)(a.default,{href:"/invoices",className:"text-slate-400 hover:text-white transition-colors",children:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Edit Invoice"}),(0,i.jsx)("p",{className:"text-slate-400",children:"Update invoice details"})]})]}),(0,i.jsx)("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6",children:(0,i.jsxs)("form",{onSubmit:w,children:[(0,i.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-slate-400 text-sm mb-2",children:"Client *"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("input",{type:"text",placeholder:"Search client...",value:h?d:(null==_?void 0:_.name)||"",onChange:e=>{u(e.target.value),m(!0),e.target.value||N({...j,client_id:""})},onFocus:()=>m(!0),className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",required:!j.client_id}),h&&(0,i.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-slate-800 border border-slate-700 rounded-xl shadow-lg max-h-60 overflow-y-auto",children:0===C.length?(0,i.jsx)("div",{className:"p-3 text-slate-500",children:"No clients found"}):C.map(e=>(0,i.jsx)("div",{onClick:()=>{N({...j,client_id:String(e.id)}),u(""),m(!1)},className:"p-3 hover:bg-slate-700 cursor-pointer text-white transition-colors",children:e.name},e.id))}),h&&(0,i.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>m(!1)})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-slate-400 text-sm mb-2",children:"Invoice Date *"}),(0,i.jsx)("input",{type:"date",value:j.invoice_date,onChange:e=>N({...j,invoice_date:e.target.value}),className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-slate-400 text-sm mb-2",children:"Due Date *"}),(0,i.jsx)("input",{type:"date",value:j.due_date,onChange:e=>N({...j,due_date:e.target.value}),className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",required:!0})]})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"block text-slate-400 text-sm mb-3",children:"Items"}),(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-3 mb-2 text-slate-500 text-sm",children:[(0,i.jsx)("div",{className:"col-span-5",children:"Description"}),(0,i.jsx)("div",{className:"col-span-2",children:"Unit"}),(0,i.jsx)("div",{className:"col-span-2",children:"Qty"}),(0,i.jsx)("div",{className:"col-span-2",children:"Price"}),(0,i.jsx)("div",{className:"col-span-1"})]}),(0,i.jsx)("div",{className:"space-y-3",children:j.items.map((e,t)=>(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,i.jsx)("input",{type:"text",list:"descriptions",placeholder:"Description",value:e.description,onChange:e=>k(t,"description",e.target.value),className:"col-span-5 p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",required:!0}),(0,i.jsxs)("select",{value:e.unit,onChange:e=>k(t,"unit",e.target.value),className:"col-span-2 p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",children:[(0,i.jsx)("option",{value:"h",children:"h"}),(0,i.jsx)("option",{value:"pcs",children:"pcs"}),(0,i.jsx)("option",{value:"m\xb2",children:"m\xb2"}),(0,i.jsx)("option",{value:"m",children:"m"}),(0,i.jsx)("option",{value:"kg",children:"kg"})]}),(0,i.jsx)("input",{type:"number",placeholder:"Qty",value:e.quantity,onChange:e=>k(t,"quantity",parseFloat(e.target.value)||0),className:"col-span-2 p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",min:"0",step:"0.01"}),(0,i.jsx)("input",{type:"number",placeholder:"Price",value:e.price,onChange:e=>k(t,"price",parseFloat(e.target.value)||0),className:"col-span-2 p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",min:"0",step:"0.01"}),(0,i.jsx)("button",{type:"button",onClick:()=>S(t),className:"col-span-1 flex items-center justify-center text-red-400 hover:text-red-300 transition-colors",children:(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))}),(0,i.jsxs)("button",{type:"button",onClick:()=>{N({...j,items:[...j.items,{...l}]})},className:"mt-3 text-blue-400 hover:text-blue-300 transition-colors flex items-center gap-1",children:[(0,i.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add item"]}),(0,i.jsx)("datalist",{id:"descriptions",children:p.map((e,t)=>(0,i.jsx)("option",{value:e},t))})]}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("label",{className:"block text-slate-400 text-sm mb-2",children:"Notes"}),(0,i.jsx)("textarea",{value:j.notes,onChange:e=>N({...j,notes:e.target.value}),className:"w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-white focus:border-blue-500 focus:outline-none transition-colors",rows:2})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-slate-800",children:[(0,i.jsxs)("div",{className:"text-2xl font-bold text-white",children:["Total: ",j.items.reduce((e,t)=>e+t.quantity*t.price,0).toFixed(2)," EUR"]}),(0,i.jsxs)("div",{className:"flex gap-4",children:[(0,i.jsx)(a.default,{href:"/invoices",className:"px-8 py-3 rounded-xl font-medium bg-slate-800 text-slate-300 hover:bg-slate-700 transition-colors",children:"Cancel"}),(0,i.jsx)("button",{type:"submit",disabled:g,className:"bg-gradient-to-r from-blue-500 to-cyan-400 text-white px-8 py-3 rounded-xl font-medium hover:opacity-90 transition-opacity disabled:opacity-50 flex items-center gap-2",children:g?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Update Invoice"]})})]})]})]})})]})}function d(){return(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)("div",{className:"text-white p-8",children:"Loading..."}),children:(0,i.jsx)(c,{})})}},6264:function(e,t,s){"use strict";s.d(t,{Ef:function(){return l},I8:function(){return o},N5:function(){return a},hi:function(){return n},lw:function(){return d},ot:function(){return c},yj:function(){return r}});let i="http://localhost:8000/api";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=localStorage.getItem("token"),n={headers:{"Content-Type":"application/json",Accept:"application/json",...s&&{Authorization:"Bearer ".concat(s)},...t.headers},...t},o=await fetch("".concat(i).concat(e),n);if(401===o.status)throw localStorage.removeItem("token"),window.location.href="/login",Error("Unauthorized");let a=await o.json();if(!o.ok)throw Error(a.message||"Something went wrong");return a}let o={register:e=>n("/register",{method:"POST",body:JSON.stringify(e)}),login:e=>n("/login",{method:"POST",body:JSON.stringify(e)}),logout:()=>n("/logout",{method:"POST"}),user:()=>n("/user")},a={get:()=>n("/profile"),update:e=>n("/profile",{method:"PUT",body:JSON.stringify(e)}),uploadSignature:async e=>{let t=localStorage.getItem("token"),s=new FormData;s.append("signature",e);let n=await fetch("".concat(i,"/profile/signature"),{method:"POST",headers:{Accept:"application/json",...t&&{Authorization:"Bearer ".concat(t)}},body:s});if(!n.ok)throw Error((await n.json()).message||"Upload failed");return n.json()},deleteSignature:()=>n("/profile/signature",{method:"DELETE"})},r={list:()=>n("/clients"),get:e=>n("/clients/".concat(e)),create:e=>n("/clients",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>n("/clients/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>n("/clients/".concat(e),{method:"DELETE"})},l={list:()=>n("/invoices"),listPaginated:e=>n("/invoices?".concat(e)),get:e=>n("/invoices/".concat(e)),create:e=>n("/invoices",{method:"POST",body:JSON.stringify(e)}),update:(e,t)=>n("/invoices/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:e=>n("/invoices/".concat(e),{method:"DELETE"}),pdf:e=>"".concat(i,"/invoices/").concat(e,"/pdf?token=").concat(localStorage.getItem("token"))},c={get:e=>n("/stats?period=".concat(e))},d={list:()=>n("/activity")}},6463:function(e,t,s){"use strict";var i=s(1169);s.o(i,"usePathname")&&s.d(t,{usePathname:function(){return i.usePathname}}),s.o(i,"useRouter")&&s.d(t,{useRouter:function(){return i.useRouter}}),s.o(i,"useSearchParams")&&s.d(t,{useSearchParams:function(){return i.useSearchParams}})}},function(e){e.O(0,[138,971,23,744],function(){return e(e.s=5463)}),_N_E=e.O()}]);